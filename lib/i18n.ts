import * as Localization from 'expo-localization';

export type Lang = 'en' | 'tr';
export type LanguagePref = 'system' | Lang;

export function detectLang(): Lang {
  try {
    const locales = Localization.getLocales?.();
    const code = locales && locales.length ? (locales[0].languageCode || '').toLowerCase() : '';
    if (code?.startsWith('tr')) return 'tr';
  } catch {} // eslint-disable-line no-empty
  return 'en';
}

export function resolveLang(pref: LanguagePref | undefined): Lang {
  if (!pref || pref === 'system') return detectLang();
  return pref;
}

const dict: Record<Lang, Record<string, string>> = {
  en: {
    'tabs.timer': 'Timer',
    'tabs.tasks': 'Tasks',
    'tabs.stats': 'Stats',
    'tabs.settings': 'Settings',

    'timer.heading': 'RETRO FOCUS',
    'timer.focus': 'FOCUS MODE',
    'timer.break': 'BREAK TIME',
    'timer.score.work': 'WORK SESSIONS',
    'timer.score.short': 'SHORT BREAKS',
    'timer.score.long': 'LONG BREAKS',
    'timer.score.streak': 'DAY STREAK',
    'timer.score.combo': 'SCORE STREAK',
    'timer.score.title': 'SESSION OVERVIEW',
    'timer.score.total': 'TOTAL SCORE',
    'label.sessions': 'SESSIONS',

    'tasks.title': 'TASK QUEUE',
    'tasks.addNew': 'ADD NEW TASK',
    'tasks.placeholder': 'ENTER TASK NAME...', 
    'tasks.completed': 'COMPLETED',
    'tasks.total': 'TOTAL',

    'stats.title': 'PRODUCTIVITY MATRIX',
    'stats.subtitle': 'PERFORMANCE ANALYTICS',
    'stats.weekly': 'WEEKLY PROGRESS',
    'stats.achievements': 'ACHIEVEMENTS',
    'stats.focusTime': 'FOCUS TIME',
    'stats.sessions': 'SESSIONS',
    'stats.streak': 'STREAK',
    'stats.tasks': 'TASKS',
    'stats.focusSubtitle': 'Accumulated',
    'stats.focusScore': 'FOCUS SCORE',
    'stats.scoreSubtitle': 'Points Earned',
    'stats.sessionsSubtitle': 'All Modes',
    'stats.streakSubtitle': 'Consecutive Days',
    'stats.breakdown': 'SESSION BREAKDOWN',
    'stats.productivity': 'FOCUS PRODUCTIVITY',
    'stats.workSessions': 'Work Sessions',
    'stats.shortBreaks': 'Short Breaks',
    'stats.longBreaks': 'Long Breaks',
    'stats.breakTime': 'Break Time',
    'stats.combo': 'SCORE STREAK',
    'stats.comboSubtitle': 'Current / Best',
    'stats.unlockedCountLabel': 'unlocked',
    'stats.unlocked': 'UNLOCKED',
    'stats.sessionLog.title': 'SESSION LOG',
    'stats.sessionLog.empty': 'No completed sessions yet.',
    'stats.achievements.focusStarter.name': 'FOCUS STARTER',
    'stats.achievements.focusStarter.description': 'Complete 10 work sessions.',
    'stats.achievements.breakChampion.name': 'BREAK CHAMPION',
    'stats.achievements.breakChampion.description': 'Log 20 breaks of any type.',
    'stats.achievements.timeKeeper.name': 'TIME KEEPER',
    'stats.achievements.timeKeeper.description': 'Reach 10 hours of focus time.',
    'stats.achievements.streakMaster.name': 'STREAK MASTER',
    'stats.achievements.streakMaster.description': 'Maintain a 7-day streak.',
    'stats.achievements.comboBreaker.name': 'COMBO BREAKER',
    'stats.achievements.comboBreaker.description': 'Reach the score streak goal.',

    'settings.title': 'SYSTEM CONFIG',
    'settings.subtitle': 'CUSTOMIZE PARAMETERS',
    'settings.language': 'LANGUAGE',
    'settings.system': 'System',
    'settings.english': 'English',
    'settings.turkish': 'Turkish',
    'settings.audio': 'AUDIO & FEEDBACK',
    'settings.sound': 'SOUND EFFECTS',
    'settings.haptics': 'HAPTIC FEEDBACK',
    'settings.notifications': 'NOTIFICATIONS',
    'settings.timers': 'TIMER SETTINGS',
    'settings.autoBreaks': 'AUTO BREAKS',
    'settings.work': 'WORK SESSION',
    'settings.shortBreak': 'SHORT BREAK',
    'settings.longBreak': 'LONG BREAK',
    'settings.freeFocus': 'FREE FOCUS',
    'settings.data': 'DATA MANAGEMENT',
    'settings.resetStats': 'Reset all data',
    'settings.resetStatsConfirm': 'This will erase every recorded session, score, and achievement. Continue?',
    'settings.resetStatsConfirmButton': 'Reset all',
    'settings.resetWorkday': 'Reset workday progress',
    'settings.resetWorkdayConfirm': "This will clear today's streak and combo progress. Continue?",
    'settings.resetWorkdayConfirmButton': 'Reset workday',
    'settings.resetAchievements': 'Reset achievements',
    'settings.resetAchievementsConfirm': 'This will lock all achievements and reset your score streak. Continue?',
    'settings.resetAchievementsConfirmButton': 'Reset achievements',
    'settings.resetTasks': 'Clear all tasks',
    'settings.resetTasksConfirm': 'This will remove every task from your list. Continue?',
    'settings.resetTasksConfirmButton': 'Clear tasks',
    'settings.about': 'ABOUT',
    'about.text': 'A productivity app inspired by\nclassic computing aesthetics',
    'about.subtext': 'Built with React Native & Expo',
    'common.cancel': 'Cancel',
  },
  tr: {
    'tabs.timer': 'Zamanlayıcı',
    'tabs.tasks': 'Görevler',
    'tabs.stats': 'İstatistik',
    'tabs.settings': 'Ayarlar',

    'timer.heading': 'RETRO ODAK',
    'timer.focus': 'ODAK MODU',
    'timer.break': 'MOLA',
    'timer.score.work': 'Calisma oturumlari',
    'timer.score.short': 'Kisa molalar',
    'timer.score.long': 'Uzun molalar',
    'timer.score.streak': 'Gun serisi',
    'timer.score.combo': 'Puan serisi',
    'timer.score.title': 'OTURUM OZETI',
    'timer.score.total': 'Toplam puan',
    'label.sessions': 'OTURUMLAR',

    'tasks.title': 'GÖREV SIRASI',
    'tasks.addNew': 'YENİ GÖREV EKLE',
    'tasks.placeholder': 'GÖREV ADI GİRİN...', 
    'tasks.completed': 'TAMAMLANDI',
    'tasks.total': 'TOPLAM',

    'stats.title': 'VERİMLİLİK MATRİSİ',
    'stats.subtitle': 'PERFORMANS ANALİZİ',
    'stats.weekly': 'HAFTALIK İLERLEME',
    'stats.achievements': 'BAŞARILAR',
    'stats.focusTime': 'ODAK SÜRESİ',
    'stats.sessions': 'OTURUM',
    'stats.streak': 'SERİ',
    'stats.tasks': 'GÖREV',
    'stats.focusSubtitle': 'Toplam sure',
    'stats.focusScore': 'ODAK PUANI',
    'stats.scoreSubtitle': 'Kazanilan puan',
    'stats.sessionsSubtitle': 'Tum modlar',
    'stats.streakSubtitle': 'Art arda gun',
    'stats.breakdown': 'OTURUM DOKUMU',
    'stats.productivity': 'ODAK VERIMLILIGI',
    'stats.workSessions': 'Calisma oturumlari',
    'stats.shortBreaks': 'Kisa molalar',
    'stats.longBreaks': 'Uzun molalar',
    'stats.breakTime': 'Mola suresi',
    'stats.combo': 'Puan serisi',
    'stats.comboSubtitle': 'Anlik / En iyi',
    'stats.unlockedCountLabel': 'acik',
    'stats.unlocked': 'ACILDI',
    'stats.sessionLog.title': 'OTURUM GEÇMİŞİ',
    'stats.sessionLog.empty': 'Henüz tamamlanmış oturum yok.',
    'stats.achievements.focusStarter.name': 'ODAK BASLANGIC',
    'stats.achievements.focusStarter.description': '10 calisma oturumu tamamla.',
    'stats.achievements.breakChampion.name': 'MOLA USTASI',
    'stats.achievements.breakChampion.description': 'Her turdan 20 mola kaydet.',
    'stats.achievements.timeKeeper.name': 'ZAMAN BEKCISI',
    'stats.achievements.timeKeeper.description': '10 saat odak suresine ulas.',
    'stats.achievements.streakMaster.name': 'SERI USTASI',
    'stats.achievements.streakMaster.description': '7 gunluk seriyi koru.',
    'stats.achievements.comboBreaker.name': 'KOMBO USTASI',
    'stats.achievements.comboBreaker.description': 'Puan serisi hedefine ulas.',

    'settings.title': 'SİSTEM AYARLARI',
    'settings.subtitle': 'PARAMETRELERİ ÖZELLEŞTİR',
    'settings.language': 'DİL',
    'settings.system': 'Sistem',
    'settings.english': 'İngilizce',
    'settings.turkish': 'Turkce',
    'settings.audio': 'SES & GERİ BİLDİRİM',
    'settings.sound': 'SES EFEKTLERİ',
    'settings.haptics': 'HAPTİK GERİ BİLDİRİM',
    'settings.notifications': 'BİLDİRİMLER',
    'settings.timers': 'ZAMANLAYICI AYARLARI',
    'settings.autoBreaks': 'OTOMATİK MOLALAR',
    'settings.work': 'ÇALIŞMA',
    'settings.shortBreak': 'KISA MOLA',
    'settings.longBreak': 'UZUN MOLA',
    'settings.freeFocus': 'Serbest odak',
    'settings.data': 'VERI YONETIMI',
    'settings.resetStats': 'Tum verileri sifirla',
    'settings.resetStatsConfirm': 'Tum oturumlar, skor ve basarilar silinecek. Devam edilsin mi?',
    'settings.resetStatsConfirmButton': 'Tumunu sifirla',
    'settings.resetWorkday': 'Gun ilerlemesini sifirla',
    'settings.resetWorkdayConfirm': 'Bugunku seri ve kombo ilerlemesi temizlenecek. Devam edilsin mi?',
    'settings.resetWorkdayConfirmButton': 'Gunu sifirla',
    'settings.resetAchievements': 'Basarilari sifirla',
    'settings.resetAchievementsConfirm': 'Tum basarilar kilitlenecek ve skor serisi sifirlanacak. Devam edilsin mi?',
    'settings.resetAchievementsConfirmButton': 'Basarilari sifirla',
    'settings.resetTasks': 'Gorevleri temizle',
    'settings.resetTasksConfirm': 'Tum gorevler silinecek. Devam edilsin mi?',
    'settings.resetTasksConfirmButton': 'Gorevleri temizle',
    'settings.about': 'HAKKINDA',
    'about.text': 'Klasik bilgisayar estetiğinden ilham alan\nverimlilik uygulaması',
    'about.subtext': 'React Native & Expo ile gelistirildi',
    'common.cancel': 'Iptal',
  },
};

export function t(key: string, lang?: Lang): string {
  const l = lang || detectLang();
  const table = dict[l] || dict.en;
  return table[key] || dict.en[key] || key;
}